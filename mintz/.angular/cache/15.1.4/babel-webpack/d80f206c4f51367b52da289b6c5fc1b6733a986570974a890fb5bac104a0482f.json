{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Cliente } from '../cliente/cliente.model';\nlet LoginComponent = class LoginComponent {\n  constructor(clienteService, routes, notificacaoService) {\n    this.clienteService = clienteService;\n    this.routes = routes;\n    this.notificacaoService = notificacaoService;\n    this.msg = \"\";\n    this.cliente = new Cliente();\n    this.clienteRecuperacao = new Cliente();\n    this.clienteNovo = new Cliente();\n    this.senha = \"\";\n    this.confirmarSenha = \"\";\n    this.senhasDiferentes = false;\n  }\n  ngOnInit() {\n    const clienteLogado = localStorage.getItem(\"cliente\");\n    if (clienteLogado != null) {\n      window.location.href = \"/minha-conta\";\n    }\n  }\n  cadastrar() {\n    if (this.clienteNovo.senha.length > 0) {\n      if (!this.senhasDiferentes) {\n        try {\n          this.clienteService.inserir(this.clienteNovo);\n          this.msg = \"Cadastro efetuado com sucesso\";\n        } catch (error) {\n          this.msg = \"Ops, parece que algo deu errado\";\n        }\n        document.getElementById('divCadastro').style.display = 'none';\n        window.alert(this.msg);\n        this.logar(this.clienteNovo);\n      } else {\n        this.notificacaoService.notificar(\"A senha e a confirmação não batem\");\n        return;\n      }\n    } else {\n      this.notificacaoService.notificar(\"A senha não pode ser vazia\");\n      return;\n    }\n  }\n  recuperarSenha() {\n    try {\n      this.clienteService.recuperarSenha(this.clienteRecuperacao).subscribe(resposta => {\n        if (resposta.nome == null) {\n          //Se a resposta for nula, significa que o usuário cujo email e senha informados não foi localizado\n          this.msg = \"Email não localizado\";\n          this.notificacaoService.notificar(this.msg);\n        } else {\n          //Se encontrar, recebe os valores\n          this.clienteRecuperacao.id = resposta.id;\n          this.clienteRecuperacao.bairro = resposta.bairro;\n          this.clienteRecuperacao.cep = resposta.cep;\n          this.clienteRecuperacao.cidade = resposta.cidade;\n          this.clienteRecuperacao.complemento = resposta.complemento;\n          this.clienteRecuperacao.cpf = resposta.cpf;\n          this.clienteRecuperacao.email = resposta.email;\n          this.clienteRecuperacao.logradouro = resposta.logradouro;\n          this.clienteRecuperacao.nome = resposta.nome;\n          this.clienteRecuperacao.senha = resposta.senha;\n          this.clienteRecuperacao.uf = resposta.uf;\n          //Chama o novo modal para atualizar a senha\n          document.getElementById('divNovaSenha').style.display = 'block';\n        }\n      });\n    } catch (error) {\n      this.msg = \"Ops, parece que algo deu errado\";\n      this.notificacaoService.notificar(this.msg);\n    }\n    document.getElementById('divEsqueciSenha').style.display = 'none';\n  }\n  atualizarSenha() {\n    if (this.senha.length > 0) {\n      if (!this.senhasDiferentes) {\n        this.clienteRecuperacao.senha = this.senha;\n      } else {\n        this.notificacaoService.notificar(\"A senha e a confirmação não batem\");\n        return;\n      }\n    } else {\n      this.notificacaoService.notificar(\"A senha não pode ser vazia\");\n      return;\n    }\n    try {\n      this.clienteService.atualizar(this.clienteRecuperacao);\n      this.cliente = this.clienteRecuperacao;\n      /*\r\n      localStorage.setItem(\"cliente\", JSON.stringify(this.clienteRecuperacao));\r\n      this.notificacaoService.notificar(\"Senha recuperada com sucesso! Bem-vindo, \" + this.clienteRecuperacao.nome);\r\n      window.location.href = \"./produtos\";\r\n      */\n      const aguardar = ms => new Promise(resolve => setTimeout(resolve, ms));\n      aguardar(1000).then(() => {\n        this.logar(this.clienteRecuperacao);\n      });\n      alert(\"Senha recuperada com sucesso\");\n    } catch (error) {\n      this.notificacaoService.notificar(\"Ops, parece que algo deu errado\");\n    }\n  }\n  verificarSenhas(senha, confirmarSenha) {\n    this.senhasDiferentes = senha !== confirmarSenha;\n  }\n  logar(login) {\n    try {\n      this.clienteService.logar(login).subscribe(resposta => {\n        if (resposta.nome == null) {\n          //Se a resposta for nula, significa que o usuário cujo email e senha informados não foi localizado\n          this.msg = \"Email ou senha incorretos\";\n          this.notificacaoService.notificar(this.msg);\n        } else {\n          //Se encontrar o usuário, salvará no local storage\n          localStorage.setItem(\"cliente\", JSON.stringify(resposta));\n          this.notificacaoService.notificar(\"Login efetuado com sucesso. Bem-vindo, \" + resposta.nome);\n          window.location.href = \"./produtos\";\n        }\n      });\n    } catch (error) {\n      this.msg = \"Ops, parece que algo deu errado\";\n      this.notificacaoService.notificar(this.msg);\n    }\n  }\n};\nLoginComponent = __decorate([Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css']\n})], LoginComponent);\nexport { LoginComponent };","map":{"version":3,"mappings":";AAAA,SAASA,SAAS,QAAQ,eAAe;AACzC,SAASC,OAAO,QAAQ,0BAA0B;AAU3C,IAAMC,cAAc,GAApB,MAAMA,cAAc;EASzBC,YACUC,cAA8B,EAC9BC,MAAsB,EACtBC,kBAAsC;IAFtC,mBAAc,GAAdF,cAAc;IACd,WAAM,GAANC,MAAM;IACN,uBAAkB,GAAlBC,kBAAkB;IAX5B,QAAG,GAAW,EAAE;IAChB,YAAO,GAAY,IAAIL,OAAO,EAAE;IAChC,uBAAkB,GAAY,IAAIA,OAAO,EAAE;IAC3C,gBAAW,GAAY,IAAIA,OAAO,EAAE;IACpC,UAAK,GAAW,EAAE;IAClB,mBAAc,GAAW,EAAE;IAC3B,qBAAgB,GAAY,KAAK;EAM/B;EAEFM,QAAQ;IACN,MAAMC,aAAa,GAAGC,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC;IACrD,IAAIF,aAAa,IAAI,IAAI,EAAE;MACzBG,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,cAAc;;EAGzC;EAEAC,SAAS;IACP,IAAI,IAAI,CAACC,WAAW,CAACC,KAAK,CAACC,MAAM,GAAG,CAAC,EAAE;MACrC,IAAI,CAAC,IAAI,CAACC,gBAAgB,EAAE;QAC1B,IAAI;UACF,IAAI,CAACd,cAAc,CAACe,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC;UAC7C,IAAI,CAACK,GAAG,GAAG,+BAA+B;SAC3C,CAAC,OAAOC,KAAK,EAAE;UACd,IAAI,CAACD,GAAG,GAAG,iCAAiC;;QAE7CE,QAAQ,CAACC,cAAc,CAAC,aAAa,CAAiB,CAACC,KAAK,CAACC,OAAO,GAAG,MAAM;QAC9Ed,MAAM,CAACe,KAAK,CAAC,IAAI,CAACN,GAAG,CAAC;QACtB,IAAI,CAACO,KAAK,CAAC,IAAI,CAACZ,WAAW,CAAC;OAE7B,MAAM;QACL,IAAI,CAACT,kBAAkB,CAACsB,SAAS,CAAC,mCAAmC,CAAC;QACtE;;KAEH,MAAM;MACL,IAAI,CAACtB,kBAAkB,CAACsB,SAAS,CAAC,4BAA4B,CAAC;MAC/D;;EAEJ;EAEAC,cAAc;IACZ,IAAI;MACF,IAAI,CAACzB,cAAc,CAACyB,cAAc,CAAC,IAAI,CAACC,kBAAkB,CAAC,CAACC,SAAS,CAClEC,QAAiB,IAAI;QACpB,IAAIA,QAAQ,CAACC,IAAI,IAAI,IAAI,EAAE;UACzB;UACA,IAAI,CAACb,GAAG,GAAG,sBAAsB;UACjC,IAAI,CAACd,kBAAkB,CAACsB,SAAS,CAAC,IAAI,CAACR,GAAG,CAAC;SAC5C,MAAM;UACL;UACA,IAAI,CAACU,kBAAkB,CAACI,EAAE,GAAGF,QAAQ,CAACE,EAAE;UACxC,IAAI,CAACJ,kBAAkB,CAACK,MAAM,GAAGH,QAAQ,CAACG,MAAM;UAChD,IAAI,CAACL,kBAAkB,CAACM,GAAG,GAAGJ,QAAQ,CAACI,GAAG;UAC1C,IAAI,CAACN,kBAAkB,CAACO,MAAM,GAAGL,QAAQ,CAACK,MAAM;UAChD,IAAI,CAACP,kBAAkB,CAACQ,WAAW,GAAGN,QAAQ,CAACM,WAAW;UAC1D,IAAI,CAACR,kBAAkB,CAACS,GAAG,GAAGP,QAAQ,CAACO,GAAG;UAC1C,IAAI,CAACT,kBAAkB,CAACU,KAAK,GAAGR,QAAQ,CAACQ,KAAK;UAC9C,IAAI,CAACV,kBAAkB,CAACW,UAAU,GAAGT,QAAQ,CAACS,UAAU;UACxD,IAAI,CAACX,kBAAkB,CAACG,IAAI,GAAGD,QAAQ,CAACC,IAAI;UAC5C,IAAI,CAACH,kBAAkB,CAACd,KAAK,GAAGgB,QAAQ,CAAChB,KAAK;UAC9C,IAAI,CAACc,kBAAkB,CAACY,EAAE,GAAGV,QAAQ,CAACU,EAAE;UAExC;UACCpB,QAAQ,CAACC,cAAc,CAAC,cAAc,CAAiB,CAACC,KAAK,CAACC,OAAO,GAAC,OAAO;;MAElF,CAAC,CACF;KAEF,CAAC,OAAOJ,KAAK,EAAE;MACd,IAAI,CAACD,GAAG,GAAG,iCAAiC;MAC5C,IAAI,CAACd,kBAAkB,CAACsB,SAAS,CAAC,IAAI,CAACR,GAAG,CAAC;;IAG5CE,QAAQ,CAACC,cAAc,CAAC,iBAAiB,CAAiB,CAACC,KAAK,CAACC,OAAO,GAAG,MAAM;EACpF;EAEAkB,cAAc;IACZ,IAAI,IAAI,CAAC3B,KAAK,CAACC,MAAM,GAAG,CAAC,EAAE;MACzB,IAAI,CAAC,IAAI,CAACC,gBAAgB,EAAE;QAC1B,IAAI,CAACY,kBAAkB,CAACd,KAAK,GAAG,IAAI,CAACA,KAAK;OAC3C,MAAM;QACL,IAAI,CAACV,kBAAkB,CAACsB,SAAS,CAAC,mCAAmC,CAAC;QACtE;;KAEH,MAAM;MACL,IAAI,CAACtB,kBAAkB,CAACsB,SAAS,CAAC,4BAA4B,CAAC;MAC/D;;IAEF,IAAI;MACA,IAAI,CAACxB,cAAc,CAACwC,SAAS,CAAC,IAAI,CAACd,kBAAkB,CAAC;MACtD,IAAI,CAACe,OAAO,GAAG,IAAI,CAACf,kBAAkB;MACtC;;;;;MAMA,MAAMgB,QAAQ,GAAIC,EAAU,IAAK,IAAIC,OAAO,CAACC,OAAO,IAAIC,UAAU,CAACD,OAAO,EAAEF,EAAE,CAAC,CAAC;MAChFD,QAAQ,CAAC,IAAI,CAAC,CAACK,IAAI,CAAC,MAAK;QACvB,IAAI,CAACxB,KAAK,CAAC,IAAI,CAACG,kBAAkB,CAAC;MACrC,CAAC,CAAC;MAEFJ,KAAK,CAAC,8BAA8B,CAAC;KACxC,CAAC,OAAOL,KAAK,EAAE;MACd,IAAI,CAACf,kBAAkB,CAACsB,SAAS,CAAC,iCAAiC,CAAC;;EAExE;EAEAwB,eAAe,CAACpC,KAAa,EAAEqC,cAAsB;IACnD,IAAI,CAACnC,gBAAgB,GAAGF,KAAK,KAAKqC,cAAc;EAClD;EAEA1B,KAAK,CAAC2B,KAAc;IAClB,IAAI;MACF,IAAI,CAAClD,cAAc,CAACuB,KAAK,CAAC2B,KAAK,CAAC,CAACvB,SAAS,CACvCC,QAAiB,IAAI;QACpB,IAAIA,QAAQ,CAACC,IAAI,IAAI,IAAI,EAAE;UACzB;UACA,IAAI,CAACb,GAAG,GAAG,2BAA2B;UACtC,IAAI,CAACd,kBAAkB,CAACsB,SAAS,CAAC,IAAI,CAACR,GAAG,CAAC;SAC5C,MAAM;UACL;UACAX,YAAY,CAAC8C,OAAO,CAAC,SAAS,EAAEC,IAAI,CAACC,SAAS,CAACzB,QAAQ,CAAC,CAAC;UACzD,IAAI,CAAC1B,kBAAkB,CAACsB,SAAS,CAAC,yCAAyC,GAAGI,QAAQ,CAACC,IAAI,CAAC;UAC5FtB,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,YAAY;;MAEvC,CAAC,CACF;KAEF,CAAC,OAAOQ,KAAK,EAAE;MACd,IAAI,CAACD,GAAG,GAAG,iCAAiC;MAC5C,IAAI,CAACd,kBAAkB,CAACsB,SAAS,CAAC,IAAI,CAACR,GAAG,CAAC;;EAE/C;CACD;AA5IYlB,cAAc,eAL1BF,SAAS,CAAC;EACT0D,QAAQ,EAAE,WAAW;EACrBC,WAAW,EAAE,wBAAwB;EACrCC,SAAS,EAAE,CAAC,uBAAuB;CACpC,CAAC,GACW1D,cAAc,CA4I1B;SA5IYA,cAAc","names":["Component","Cliente","LoginComponent","constructor","clienteService","routes","notificacaoService","ngOnInit","clienteLogado","localStorage","getItem","window","location","href","cadastrar","clienteNovo","senha","length","senhasDiferentes","inserir","msg","error","document","getElementById","style","display","alert","logar","notificar","recuperarSenha","clienteRecuperacao","subscribe","resposta","nome","id","bairro","cep","cidade","complemento","cpf","email","logradouro","uf","atualizarSenha","atualizar","cliente","aguardar","ms","Promise","resolve","setTimeout","then","verificarSenhas","confirmarSenha","login","setItem","JSON","stringify","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["D:\\OneDrive - Fatec Centro Paula Souza\\Documentos\\Estudos\\Fatec_ADS\\4-Web\\pw-p2\\mintz\\src\\app\\login\\login.component.ts"],"sourcesContent":["import { Component } from '@angular/core';\r\nimport { Cliente } from '../cliente/cliente.model';\r\nimport { ClienteService } from '../services/cliente.service';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { NotificacaoService } from '../services/notificacao.service';\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  templateUrl: './login.component.html',\r\n  styleUrls: ['./login.component.css']\r\n})\r\nexport class LoginComponent {\r\n  msg: string = \"\";\r\n  cliente: Cliente = new Cliente();\r\n  clienteRecuperacao: Cliente = new Cliente();\r\n  clienteNovo: Cliente = new Cliente();\r\n  senha: string = \"\";\r\n  confirmarSenha: string = \"\";\r\n  senhasDiferentes: boolean = false;\r\n\r\n  constructor(\r\n    private clienteService: ClienteService,\r\n    private routes: ActivatedRoute,\r\n    private notificacaoService: NotificacaoService\r\n  ){}\r\n\r\n  ngOnInit(){\r\n    const clienteLogado = localStorage.getItem(\"cliente\");\r\n    if (clienteLogado != null) {\r\n      window.location.href = \"/minha-conta\"\r\n      \r\n    }\r\n  }\r\n    \r\n  cadastrar(): void{\r\n    if (this.clienteNovo.senha.length > 0) {\r\n      if (!this.senhasDiferentes) {\r\n        try {\r\n          this.clienteService.inserir(this.clienteNovo);\r\n          this.msg = \"Cadastro efetuado com sucesso\"\r\n        } catch (error) {\r\n          this.msg = \"Ops, parece que algo deu errado\";\r\n        }\r\n        (document.getElementById('divCadastro') as HTMLElement).style.display = 'none';\r\n        window.alert(this.msg);\r\n        this.logar(this.clienteNovo);\r\n\r\n      } else {\r\n        this.notificacaoService.notificar(\"A senha e a confirmação não batem\");\r\n        return;\r\n      }\r\n    } else {\r\n      this.notificacaoService.notificar(\"A senha não pode ser vazia\");\r\n      return;\r\n    }\r\n  }\r\n\r\n  recuperarSenha(): void{\r\n    try {\r\n      this.clienteService.recuperarSenha(this.clienteRecuperacao).subscribe(\r\n        (resposta: Cliente) => {\r\n          if (resposta.nome == null) {\r\n            //Se a resposta for nula, significa que o usuário cujo email e senha informados não foi localizado\r\n            this.msg = \"Email não localizado\";\r\n            this.notificacaoService.notificar(this.msg);\r\n          } else {\r\n            //Se encontrar, recebe os valores\r\n            this.clienteRecuperacao.id = resposta.id;\r\n            this.clienteRecuperacao.bairro = resposta.bairro;\r\n            this.clienteRecuperacao.cep = resposta.cep;\r\n            this.clienteRecuperacao.cidade = resposta.cidade;\r\n            this.clienteRecuperacao.complemento = resposta.complemento;\r\n            this.clienteRecuperacao.cpf = resposta.cpf;\r\n            this.clienteRecuperacao.email = resposta.email;\r\n            this.clienteRecuperacao.logradouro = resposta.logradouro;\r\n            this.clienteRecuperacao.nome = resposta.nome;\r\n            this.clienteRecuperacao.senha = resposta.senha;\r\n            this.clienteRecuperacao.uf = resposta.uf;\r\n\r\n            //Chama o novo modal para atualizar a senha\r\n            (document.getElementById('divNovaSenha') as HTMLElement).style.display='block';\r\n          }\r\n        }\r\n      );\r\n      \r\n    } catch (error) {\r\n      this.msg = \"Ops, parece que algo deu errado\"\r\n      this.notificacaoService.notificar(this.msg);\r\n    }\r\n\r\n    (document.getElementById('divEsqueciSenha') as HTMLElement).style.display = 'none';\r\n  }\r\n\r\n  atualizarSenha(): void{\r\n    if (this.senha.length > 0) {\r\n      if (!this.senhasDiferentes) {\r\n        this.clienteRecuperacao.senha = this.senha;\r\n      } else {\r\n        this.notificacaoService.notificar(\"A senha e a confirmação não batem\");\r\n        return;\r\n      }\r\n    } else {\r\n      this.notificacaoService.notificar(\"A senha não pode ser vazia\");\r\n      return;\r\n    }\r\n    try {\r\n        this.clienteService.atualizar(this.clienteRecuperacao);\r\n        this.cliente = this.clienteRecuperacao;\r\n        /*\r\n        localStorage.setItem(\"cliente\", JSON.stringify(this.clienteRecuperacao));\r\n        this.notificacaoService.notificar(\"Senha recuperada com sucesso! Bem-vindo, \" + this.clienteRecuperacao.nome);\r\n        window.location.href = \"./produtos\";\r\n        */\r\n        \r\n        const aguardar = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\r\n        aguardar(1000).then(() => {\r\n          this.logar(this.clienteRecuperacao);\r\n        });\r\n\r\n        alert(\"Senha recuperada com sucesso\");\r\n    } catch (error) {\r\n      this.notificacaoService.notificar(\"Ops, parece que algo deu errado\");\r\n    }\r\n  }\r\n\r\n  verificarSenhas(senha: string, confirmarSenha: string): void{\r\n    this.senhasDiferentes = senha !== confirmarSenha;\r\n  }\r\n\r\n  logar(login: Cliente): void{\r\n    try {\r\n      this.clienteService.logar(login).subscribe(\r\n        (resposta: Cliente) => {\r\n          if (resposta.nome == null) {\r\n            //Se a resposta for nula, significa que o usuário cujo email e senha informados não foi localizado\r\n            this.msg = \"Email ou senha incorretos\";\r\n            this.notificacaoService.notificar(this.msg);\r\n          } else {\r\n            //Se encontrar o usuário, salvará no local storage\r\n            localStorage.setItem(\"cliente\", JSON.stringify(resposta));\r\n            this.notificacaoService.notificar(\"Login efetuado com sucesso. Bem-vindo, \" + resposta.nome);\r\n            window.location.href = \"./produtos\";\r\n          }\r\n        }\r\n      );\r\n      \r\n    } catch (error) {\r\n      this.msg = \"Ops, parece que algo deu errado\"\r\n      this.notificacaoService.notificar(this.msg);\r\n    }\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}